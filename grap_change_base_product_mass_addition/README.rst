========================================
GRAP - Change Base Product Mass Addition
========================================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-grap%2Fgrap--odoo--custom-lightgray.png?logo=github
    :target: https://github.com/grap/grap-odoo-custom/tree/12.0/grap_change_base_product_mass_addition
    :alt: grap/grap-odoo-custom

|badge1| |badge2| |badge3| 

This module is a patch module, that overwrite the function ``_inverse_set_process_qty``
of the model ``product.product`` of the module ``base_product_mass_addition``.

It avoid to call the function ``odoo.tests.Form`` that is very slow, and that is making
the module ``purchase_quick`` unusable.


**Benchmark on a Production database, run locally**
Without this module, for a purchase, calling ``_inverse_set_process_qty`` takes
- 12.469824 seconds (for a create)
- 13.837742 seconds (for an update)

With this module, the same call takes
- 0.121779 seconds (for a create)
- 0.110520 seconds (for an update)


**Benchmark on a Demo database, run locally**

Test Code show that time is divided by 12.

.. code-block:: python

    import timeit
    def test():
        orders = env["purchase.order"].search([("partner_id", "=", env.ref("base.res_partner_1").id)])
        for line in orders.mapped("order_line"):
            product = line.product_id.with_context(parent_model="purchase.order", parent_id=line.order_id.id)
            product.qty_to_process = line.product_qty * 2


Without this module :

.. code-block:: python

    >>> timeit.timeit(test, number=50)
    70.18318000599902

With this module :

.. code-block:: python

    >>> timeit.timeit(test, number=50)
    5.822203948999231

**Table of contents**

.. contents::
   :local:

Known issues / Roadmap
======================

* make the same work. (the ``if parent_model == "purchase_order"``) for
  the module ``stock_picking_quick``. (if used)

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/grap/grap-odoo-custom/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us smashing it by providing a detailed and welcomed
`feedback <https://github.com/grap/grap-odoo-custom/issues/new?body=module:%20grap_change_base_product_mass_addition%0Aversion:%2012.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
~~~~~~~

* GRAP

Contributors
~~~~~~~~~~~~

* Sylvain LE GAL (https://www.twitter.com/legalsylvain)

Maintainers
~~~~~~~~~~~

This module is part of the `grap/grap-odoo-custom <https://github.com/grap/grap-odoo-custom/tree/12.0/grap_change_base_product_mass_addition>`_ project on GitHub.

You are welcome to contribute.
